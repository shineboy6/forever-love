<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ç¨‹å­æ´¢ â€” çˆ±æ„æ»¡å±</title>
<style>
Â  :root{
Â  Â  --bg-1:#0b0710;
Â  Â  --bg-2:#261025;
Â  Â  --card-bg: rgba(255,255,255,0.95);
Â  Â  --msg-color: #111112;
Â  }
Â  html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg-1),var(--bg-2));font-family: 'Segoe UI', 'PingFang SC', system-ui, sans-serif;color:#fff;overflow:hidden}
Â  /* canvas èƒŒæ™¯ (èŠ±ç“£/å…‰æ•ˆ) */
Â  canvas#bg{position:fixed;inset:0;width:100%;height:100%;z-index:0;display:block}
Â  /* ä¸­å¿ƒå¿ƒå½¢ */
Â  .center{
Â  Â  position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);z-index:2;pointer-events:none;
Â  Â  width:min(56vmin,640px);height:min(56vmin,640px);display:grid;align-items:center;justify-items:center;
Â  }
Â  .heart-svg{width:100%;height:100%;filter:drop-shadow(0 18px 40px rgba(0,0,0,0.6));animation:pulse 1400ms ease-in-out infinite}
Â  @keyframes pulse{0%{transform:scale(0.98)}50%{transform:scale(1)}100%{transform:scale(0.98)}}
Â  /* å¼¹å¹•å®¹å™¨ */
Â  #barrage{position:fixed;inset:0;z-index:3;pointer-events:none}
Â  .msg{
Â  Â  position:absolute;
Â  Â  pointer-events:auto;
Â  Â  background:var(--card-bg);
Â  Â  color:var(--msg-color);
Â  Â  padding:12px 14px;
Â  Â  border-radius:16px;
Â  Â  max-width:360px;
Â  Â  box-shadow:0 12px 30px rgba(0,0,0,0.45);
Â  Â  opacity:0; transform:translateY(12px) scale(0.995);
Â  Â  transition:opacity 450ms ease, transform 450ms ease;
Â  Â  font-size:16px; line-height:1.4;
Â  }
Â  .msg.show{opacity:1;transform:translateY(0) scale(1)}
Â  .controls{
Â  Â  position:fixed;right:18px;bottom:18px;z-index:6;display:flex;gap:10px;align-items:center;
Â  }
Â  .btn{
Â  Â  background:rgba(255,255,255,0.9);color:#111;border:0;padding:10px 12px;border-radius:12px;cursor:pointer;font-weight:600;
Â  Â  box-shadow:0 6px 16px rgba(0,0,0,0.3);
Â  }
Â  .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
Â  @media (prefers-reduced-motion:reduce){.heart-svg, .msg{transition:none!important;animation:none!important}}
</style>
</head>
<body>

<canvas id="bg" aria-hidden="true"></canvas>

<div class="center" aria-hidden="true">
Â  Â  <svg class="heart-svg" viewBox="0 0 100 100" role="img" aria-label="è·³åŠ¨çš„å¿ƒå½¢">
Â  Â  <defs>
Â  Â  Â  <linearGradient id="g" x1="0" x2="1">
Â  Â  Â  Â  <stop offset="0%" stop-color="#ffb0c0"/>
Â  Â  Â  Â  <stop offset="100%" stop-color="#ff6a86"/>
Â  Â  Â  </linearGradient>
Â  Â  </defs>
Â  Â  <g transform="translate(50,50) scale(0.9)">
Â  Â  Â  <path d="M0 -22 C -12 -40 -40 -32 -40 -6 C -40 18 -4 36 0 46 C 4 36 40 18 40 -6 C 40 -32 12 -40 0 -22 Z" fill="url(#g)"></path>
Â  Â  </g>
Â  </svg>
</div>

<div id="barrage" aria-live="polite" aria-atomic="true"></div>

<div class="controls" role="region" aria-label="æ’­æ”¾æ§åˆ¶">
Â  <button id="musicBtn" class="btn" aria-pressed="false" title="æ’­æ”¾ / æš‚åœéŸ³ä¹">ğŸµ æ’­æ”¾</button>
Â  <button id="pauseBtn" class="btn" aria-pressed="false" title="æš‚åœ / æ¢å¤å¼¹å¹•">â¯ æš‚åœå¼¹å¹•</button>
</div>

<div id="sr" class="sr-only" aria-hidden="false"></div>


<script>
// [!GEMINI ç»ˆæä¿®å¤]
// æˆ‘ä»¬æŠŠæ‰€æœ‰ä»£ç éƒ½æ”¾è¿›è¿™ä¸ª 'DOMContentLoaded' äº‹ä»¶é‡Œã€‚
// è¿™èƒ½ä¿è¯ HTML é¡µé¢ï¼ˆæŒ‰é’®ã€ç”»å¸ƒç­‰ï¼‰å®Œå…¨åŠ è½½å®Œæ¯•åï¼ŒJS æ‰ä¼šå¼€å§‹è¿è¡Œã€‚
document.addEventListener('DOMContentLoaded', () => {

    /* ---------------------
    Â  ä½¿ç”¨è¯´æ˜
    Â  - è¯·æŠŠéŸ³ä¹æ–‡ä»¶å‘½åä¸º special_person.mp3 å¹¶ä¸æ­¤ HTML æ”¾åœ¨åŒä¸€ç›®å½•ã€‚
    Â  - åŒå‡»æ‰“å¼€æ–‡ä»¶æˆ–éƒ¨ç½²åˆ°é™æ€æœåŠ¡å™¨å³å¯ã€‚
    ----------------------*/

    /* æ¶ˆæ¯æ±  */
    const ORIGINAL_MESSAGES = [
    Â  'è´è´ï¼Œä½ åœ¨æˆ‘çœ¼ä¸­æ˜¯æœ€ç¾ã€‚',
    Â  'å’Œä½ åœ¨ä¸€èµ·ä»¿ä½›ä¸–ç•Œè¢«ç‚¹äº®äº†ã€‚',
    Â  'æˆ‘æƒ³è®©ä½ æ— æ—¶æ— åˆ»éƒ½æƒ³å’Œæˆ‘åœ¨ä¸€èµ·ï¼Œå°±åƒæˆ‘æƒ³ä½ é‚£æ ·ã€‚',
    Â  'ä½ ä¸ç”¨æ‹…å¿ƒæˆ‘ä»¬çš„çˆ±æ„ä¼šè¢«æ—¶é—´æ¶ˆç£¨ï¼Œå› ä¸ºæ¯å¤©é†’æ¥éƒ½ä¼šè¢«æ³¨å…¥æ›´å¤šçˆ±æ„ï¼Œåªä¼šè¶Šæ¥è¶Šå¤šã€‚',
    Â  'æˆ‘åœ¨ä¹çš„æ˜¯ä½ èˆ’ä¸èˆ’æœå¥ä¸å¥åº·ï¼Œè€Œä¸æ˜¯ç¾ä¸ç¾ç˜¦ä¸ç˜¦ï¼Œæ‰€ä»¥å¸Œæœ›ä½ å¥½å¥½åƒé¥­å¥½å¥½ç¡è§‰ã€‚',
    Â  'æˆ‘çˆ±ä½ ã€‚',
    Â  'ä¸€ç”Ÿä¸€ä¸–ä¸€åŒäººï¼Œä¸€å¿ƒä¸€æ„ä¸€ä¸ªäººã€‚',
    Â  'å› ä¸ºä½ æˆ‘ç›¸ä¿¡æˆ‘çš„æœªæ¥ä¸€å®šä¼šè¿‡å¾—å¾ˆå¥½ã€‚',
    Â  'æ´¢æ´¢å®è´æ¯å¤©éƒ½å¼€å¿ƒã€‚',
    Â  'ç¼˜å®šæ­¤ç”Ÿï¼Œç¼˜å®šæ­¤äººã€‚',
    Â  'æ¯ä¸€æ¬¡å¿ƒè·³éƒ½æ˜¯çˆ±ä½ çš„å›å“ã€‚',
    Â  'æˆ‘ä¿©å¤©ä¸‹ç¬¬ä¸€å¥½ï¼',
    Â  'è¦è¿™æ ·ä¸€ç›´å¹¸ç¦ä¸‹å»ã€‚',
    Â  'çˆ±ä¸Šäº†ä½ ï¼Œä»æ­¤çœ¼ä¸­å†æ— ä»–äººã€‚',
    Â  'çˆ±äººå¯¹æˆ‘æ¥è¯´ä¸æ˜¯é€‰æ‹©é¢˜ï¼Œè€Œæ˜¯ç”¨å¿ƒæ‰“ç£¨åçš„å¡«ç©ºï¼Œå¿ƒä¸Šæœ‰äº†ä½ å°±å·²ç»äº¤å·äº†ï¼Œæˆ‘å¸Œæœ›ä½ ä¹Ÿæ˜¯ã€‚',
    Â  'æˆ‘æƒ³æˆä¸ºä½ çš„å”¯ä¸€ï¼Œå› ä¸ºä½ å¯¹æˆ‘æ¥è¯´å°±æ˜¯ã€‚',
    Â  'ç¨‹å­æ´¢ï¼Œæˆ‘æƒ³ä¸€ç›´å’Œä½ åœ¨ä¸€èµ·ã€‚'
    ];

    /* é…ç½® */
    const DISPLAY_TIME = 7000;Â  Â 
    const MAX_SIMULTANEOUS = 3;Â  Â 
    const INITIAL_BURST = 6;Â  Â  Â  
    const BATCH_MIN = 2;Â  Â  Â  Â  Â  
    const BATCH_MAX = 3;Â  Â  Â  Â  Â  
    const TRY_POS_ATTEMPTS = 12;Â  Â 

    /* DOM */
    const barrage = document.getElementById('barrage');
    const sr = document.getElementById('sr');
    const musicBtn = document.getElementById('musicBtn');
    const pauseBtn = document.getElementById('pauseBtn');
    const canvas = document.getElementById('bg'); 
    const ctx = canvas.getContext('2d');

    /* éŸ³ä¹ */
    const audio = new Audio('./special_person.mp3');
    audio.preload = 'auto';
    audio.volume = 0.32;
    let audioPlayed = false; 

    audio.addEventListener('ended', ()=>{
    Â  audioPlayed = true;
    Â  musicBtn.textContent = 'ğŸµ æ’­æ”¾';
    Â  musicBtn.setAttribute('aria-pressed','false');
    });

    musicBtn.addEventListener('click', async ()=>{
    Â  if (audio.paused && !audioPlayed) {
    Â  Â  try {
    Â  Â  Â  await audio.play();
    Â  Â  Â  musicBtn.textContent = 'ğŸ”‡ æš‚åœ';
    Â  Â  Â  musicBtn.setAttribute('aria-pressed','true');
    Â  Â  } catch(e) {
    Â  Â  Â  alert('æµè§ˆå™¨é˜»æ­¢è‡ªåŠ¨æ’­æ”¾ã€‚è¯·å…ˆå…è®¸æˆ–åœ¨é¡µé¢ç‚¹å‡»æ’­æ”¾ã€‚');
    Â  Â  }
    Â  } else {
    Â  Â  audio.pause();
    Â  Â  musicBtn.textContent = 'ğŸµ æ’­æ”¾';
    Â  Â  musicBtn.setAttribute('aria-pressed','false');
    Â  }
    });

    window.addEventListener('load', ()=>{
    Â  audio.play().then(()=>{ musicBtn.textContent='ğŸ”‡ æš‚åœ'; musicBtn.setAttribute('aria-pressed','true'); })
    Â  Â  .catch(()=>{/*æ— åŠ¨ä½œï¼šç­‰å¾…ç”¨æˆ·ç‚¹å‡»*/});
    });

    /* å¼¹å¹•æ¶ˆæ¯ç®¡ç† */
    let pool = [];
    function refillPool(){ pool = shuffle([...ORIGINAL_MESSAGES]); }
    function shuffle(arr){
    Â  for(let i=arr.length-1;i>0;i--){
    Â  Â  const j=Math.floor(Math.random()*(i+1));
    Â  Â  [arr[i],arr[j]] = [arr[j],arr[i]];
    Â  }
    Â  return arr;
    }
    refillPool();

    function getVisibleRects(){
    Â  return Array.from(barrage.children).filter(c=>c.dataset.dismiss!=='1').map(el=>{
    Â  Â  const r=el.getBoundingClientRect();
    Â  Â  return {el, left:r.left, right:r.right, top:r.top, bottom:r.bottom};
    Â  });
    }

    function overlaps(x,y,w,h,existing,margin=8){
    Â  for(const e of existing){
    Â  Â  if(!(x + w + margin < e.left || x > e.right + margin || y + h + margin < e.top || y > e.bottom + margin)){
    Â  Â  Â  return true;
    Â  Â  }
    Â  }
    Â  return false;
    }

    function findPositionFor(el){
    Â  const vw = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);
    Â  const vh = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);
    Â  const rect = el.getBoundingClientRect();
    Â  const w = rect.width, h = rect.height;
    Â  const existing = getVisibleRects();
    Â  const margin = 20; 

    Â  const x_max = Math.max(0, vw - w - margin * 2);Â 
    Â  const y_max = Math.max(0, vh - h - margin * 2);

    Â  for(let i=0;i<TRY_POS_ATTEMPTS;i++){
    Â  Â  const x = Math.random() * x_max + margin;
    Â  Â  const y = Math.random() * y_max + margin;
    Â  Â  if(!overlaps(x,y,w,h,existing)) return {x,y};
    Â  }
    Â  return {Â 
    Â  Â  Â x: Math.random() * x_max + margin,Â 
    Â  Â  Â y: Math.random() * y_max + marginÂ 
    Â  Â };
    }

    function showSingleMessage(text){
    Â  const el = document.createElement('div');
    Â  el.className = 'msg';
    Â  el.tabIndex = 0;
    Â  el.textContent = text;
    Â  el.dataset.dismiss = '0';
    Â Â 
    Â  let removalTimer = null;

    Â  const removeMsg = () => {
    Â  Â  if (el.dataset.dismiss === '1') return;
    Â  Â  el.dataset.dismiss = '1';
    Â  Â  el.classList.remove('show');
    Â  Â  if (removalTimer) clearTimeout(removalTimer);
    Â  Â  setTimeout(() => el.remove(), 420);
    Â  };

    Â  const startRemovalTimer = () => {
    Â  Â  if (removalTimer) clearTimeout(removalTimer);
    Â  Â  removalTimer = setTimeout(removeMsg, DISPLAY_TIME);
    Â  };
    Â Â 
    Â  barrage.appendChild(el);
    Â Â 
    Â  el.addEventListener('keydown', (e)=>{ if(e.key==='Escape'){ removeMsg(); } });

    Â  requestAnimationFrame(()=>{
    Â  Â  const pos = findPositionFor(el);
    Â  Â  el.style.left = pos.x + 'px';
    Â  Â  el.style.top = pos.y + 'px';
    Â  Â  el.style.background = randomSoftBackground();
    Â  Â  el.style.color = '#0b0b0b';
    Â  Â  requestAnimationFrame(()=> el.classList.add('show'));
    Â  Â  sr.textContent = text;
    Â  Â  startRemovalTimer();
    Â  Â Â 
    Â  Â  el.addEventListener('mouseenter', () => {
    Â  Â  Â  if(el.dataset.dismiss==='0'){
    Â  Â  Â  Â  Â  if (removalTimer) clearTimeout(removalTimer);
    Â  Â  Â  }
    Â  Â  });
    Â  Â  el.addEventListener('mouseleave', ()=> {Â 
    Â  Â  Â  if(el.dataset.dismiss==='0'){
    Â  Â  Â  Â  Â  startRemovalTimer();
    Â  Â  Â  }
    Â  Â  });
    Â  });
    }

    function randomSoftBackground(){
    Â  const h = Math.floor(330 + Math.random()*40); 
    Â  const s = 70 + Math.floor(Math.random()*10);
    Â  const l = 85 - Math.floor(Math.random()*6);
    Â  return `hsl(${h} ${s}% ${l}%)`;
    }

    function showBatch(){
    Â  if(paused) return;
    Â  const currentVisible = barrage.children.length;
    Â  if(currentVisible >= MAX_SIMULTANEOUS) return;
    Â  const batchSize = Math.min(BATCH_MAX, Math.max(BATCH_MIN, Math.floor(Math.random()*(BATCH_MAX - BATCH_MIN + 1)) + BATCH_MIN - 1));
    Â  let toShow = batchSize;
    Â  const canShow = MAX_SIMULTANEOUS - currentVisible;
    Â  toShow = Math.min(toShow, canShow);
    Â  for(let i=0;i<toShow;i++){
    Â  Â  if(pool.length===0) refillPool();
    Â  Â  const item = pool.pop();
    Â  Â  showSingleMessage(item);
    Â  }
    }

    function initialBurst(){
    Â  let t = 120;
    Â  for(let i=0;i<INITIAL_BURST;i++){
    Â  Â  setTimeout(()=>{
    Â  Â  Â  if(pool.length===0) refillPool();
    Â  Â  Â  const item = pool.pop();
    Â  Â  Â  showSingleMessage(item);
    Â  Â  }, t);
    Â  Â  t += 220;
    Â  }
    }

    let loopTimer = null;
    let paused = false;
    function startLoop(){
    Â  if(loopTimer) clearInterval(loopTimer);
    Â  loopTimer = setInterval(()=>{
    Â  Â  if(document.hidden || paused) return;
    Â  Â  showBatch();
    Â  }, 2600);
    }

    pauseBtn.addEventListener('click', ()=>{
    Â  paused = !paused;
    Â  pauseBtn.setAttribute('aria-pressed', String(paused));
    Â  pauseBtn.textContent = paused ? 'â–¶ æ¢å¤å¼¹å¹•' : 'â¯ æš‚åœå¼¹å¹•';
    });

    window.addEventListener('keydown', (e)=>{
    Â  if(e.target && (e.target.tagName==='INPUT' || e.target.tagName==='TEXTAREA')) return;
    Â  if(e.code === 'Space'){ e.preventDefault(); paused = !paused; pauseBtn.setAttribute('aria-pressed', String(paused)); pauseBtn.textContent = paused ? 'â–¶ æ¢å¤å¼¹å¹•' : 'â¯ æš‚åœå¼¹å¹•'; }
    Â  if(e.key.toLowerCase() === 'm' && e.ctrlKey){ sr.textContent=''; }
    });

    /* èƒŒæ™¯èŠ±ç“£ */
    let W = canvas.width = innerWidth;
    let H = canvas.height = innerHeight;
    window.addEventListener('resize', ()=>{ W = canvas.width = innerWidth; H = canvas.height = innerHeight; });
    const petals = [];
    for(let i=0;i<48;i++) petals.push(makePetal());

    function makePetal(){
    Â  return {
    Â  Â  x: Math.random()*W,
    Â  Â  y: Math.random()*H,
    Â  Â  r: 6 + Math.random()*10,
    Â  Â  vx: -0.3 + Math.random()*0.6,
    Â  Â  vy: 0.2 + Math.random()*0.8,
    Â  Â  rot: Math.random()*Math.PI*2,
    Â  Â  rotSpeed: (Math.random()-0.5)*0.02,
    Â  Â  hue: 330 + Math.random()*30,
    Â  Â  alpha: 0.6 + Math.random()*0.3,
    Â  };
    }

    function drawBg(){
    Â  ctx.clearRect(0,0,W,H);
    Â  for(const p of petals){
    Â  Â  ctx.save();
    Â  Â  ctx.translate(p.x, p.y);
    Â  Â  ctx.rotate(p.rot);
    Â  Â  ctx.fillStyle = `hsla(${p.hue},70%,85%,${p.alpha})`;
    Â  Â  ctx.beginPath();
    Â  Â  ctx.ellipse(0, 0, p.r*0.9, p.r*0.6, 0, 0, Math.PI*2);
    Â  Â  ctx.fill();
    Â  Â  ctx.restore();
    Â  Â  p.x += p.vx + Math.sin(p.y/30)*0.2;
    Â  Â  p.y += p.vy;
    Â  Â  p.rot += p.rotSpeed;
    Â  Â  if(p.y > H + 20){ Object.assign(p, makePetal()); p.y = -20; p.x = Math.random()*W; }
    Â  Â  if(p.x < -30) p.x = W + 30;
    Â  Â  if(p.x > W + 30) p.x = -30;
    Â  }
    Â  requestAnimationFrame(drawBg);
    }

    /* å¯åŠ¨æµç¨‹ */
    initialBurst();
    startLoop();
    drawBg();

    audio.addEventListener('error', (e)=> {
    Â  musicBtn.textContent = 'ğŸµ (æ–‡ä»¶æœªå°±ç»ª)';
    });

    window.addEventListener('beforeunload', ()=>{ if(loopTimer) clearInterval(loopTimer); });

}); 
</script>

</body>
</html>
